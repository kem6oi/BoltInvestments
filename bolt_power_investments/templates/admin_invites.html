<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - Admin</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .form-container { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; background-color: #f9f9f9; }
        .form-container h3 { margin-top: 0; }
        .form-container label { display: block; margin-top: 10px; }
        .form-container input[type="number"], .form-container input[type="submit"] { padding: 8px; margin-top: 5px; }
        .quick-links ul { list-style: none; padding: 0; }
        .quick-links li a { text-decoration: none; color: #007bff; padding: 5px 0; display: block; }
        .quick-links li a:hover { text-decoration: underline; }
        .flashes { list-style: none; padding: 0; margin-bottom: 15px; }
        .flashes li { padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .flashes .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flashes .danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h2>{{ title }}</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="form-container">
        <h3>Generate New Invitation Code</h3>
        <form method="POST" action="{{ url_for('admin.generate_invitation') }}">
            <div>
                <label for="uses_left">Uses Left:</label>
                <input type="number" id="uses_left" name="uses_left" value="1" min="1" required>
            </div>
            <div>
                <label for="expiration_days">Expires in (days from now, optional):</label>
                <input type="number" id="expiration_days" name="expiration_days" min="1">
            </div>
            <div>
                <input type="submit" value="Generate New Code">
            </div>
        </form>
    </div>

    <h3>Existing Invitation Codes</h3>
    {% if invitations %}
        <table>
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Uses Left</th>
                    <th>Expiration Date</th>
                    <th>Status</th>
                    <th>Generated By</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for invite in invitations %}
                    <tr>
                        <td>{{ invite.code }}</td>
                        <td>{{ invite.uses_left }}</td>
                        <td>{{ invite.expiration_date.strftime('%Y-%m-%d %H:%M:%S UTC') if invite.expiration_date else 'Never' }}</td>
                        <td>
                            {% if not invite.is_active %}
                                Revoked
                            {% elif invite.expiration_date and invite.expiration_date < now_utc %}
                                Expired
                            {% elif invite.uses_left == 0 %}
                                Used Up
                            {% else %}
                                Active
                            {% endif %}
                        </td>
                        <td>{{ invite.generated_by.email if invite.generated_by else 'System/Unknown' }}</td>
                        <td>{{ invite.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</td>
                        <td> <!-- Actions Column -->
                            {% if invite.is_active and (not invite.expiration_date or invite.expiration_date >= now_utc) and invite.uses_left > 0 %}
                                <a href="{{ url_for('admin.revoke_invitation', invite_id=invite.id) }}">Revoke</a>
                                {# TODO: Convert to POST for security #}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No invitation codes found.</p>
    {% endif %}

    <div class="quick-links">
        <p><a href="{{ url_for('admin.dashboard') }}">Back to Admin Dashboard</a></p>
    </div>
</body>
</html>
